LLVM_BUILD :=  /opt/homebrew/opt/llvm/
Dragon_DIR := ${CURDIR}/src
Dragon_BUILD := ${CURDIR}/build

NPROC := ${shell sysctl -n hw.ncpu}

build_codedep_func = \
	(mkdir -p ${2} \
		&& cd ${2} \
		&& PATH=${LLVM_BUILD}/bin:${PATH} \
			LLVM_ROOT_DIR=${LLVM_BUILD}/bin \
			LLVM_LIBRARY_DIRS=${LLVM_BUILD}/lib \
			LLVM_INCLUDE_DIRS=${LLVM_BUILD}/include \
			CC=gcc CXX=g++ \
            cmake ${1} -DCMAKE_BUILD_TYPE=Release \
                -DCMAKE_CXX_FLAGS_RELEASE="-fno-rtti -Ofast -fomit-frame-pointer -UNDEBUG_ENABLE -flto -std=c++14" \
		&& make -j${NPROC})

all: codesummary

codesummary:
	$(call build_codedep_func, ${Dragon_DIR}, ${Dragon_BUILD})

